<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>圆度误差实验</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div class="main-div">
    <canvas id="mainCanvas" width="900" height="450"></canvas>
    <table id="mainTable">
        <tr>
            <td > 实验数据：</td>
            <td></td>
            <td>极坐标图</td>
        </tr>
        <tr>
            <td rowspan="2">
                <div id="flow_table" >
                    <table id="roundnessData">
                        <thead >
                        <tr>
                            <th >序号</th>
                            <th>角度坐标(°)</th>
                            <th>相对矢径误差△Ri(μm)</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr>
                            <td>0</td>
                            <td class="exm_data" id="a0"></td>
                            <td class="exm_data" id="e0"></td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td class="exm_data" id="a1"></td>
                            <td class="exm_data" id="e1"></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td class="exm_data" id="a2"></td>
                            <td class="exm_data" id="e2"></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td class="exm_data" id="a3"></td>
                            <td class="exm_data" id="e3"></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td class="exm_data" id="a4"></td>
                            <td class="exm_data" id="e4"></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td class="exm_data" id="a5"></td>
                            <td class="exm_data" id="e5"></td>
                        </tr>
                        </tbody>

                    </table>
                </div>

            </td>
            <td><div style="width: 20px"></div></td>
            <td>
                <canvas id="myDial" width="250" height="200"></canvas><br/>
                <button onclick="calcu()">最小二乘法计算圆度误差</button>
            </td>
        </tr>
        <tr>
            <table id="MessageTable">
                <tr><div style="height: 20px"></div></tr>
                <tr>
                    <td>u1(mm)</td>
                    <td>u2(mm)</td>
                    <td>R(mm)</td>
                    <td>圆度误差(mm)</td>
                </tr>
                <tr>
                   <td id="u1">0</td>
                    <td id="u2">0</td>
                    <td id="r">0</td>
                    <td id="f">0</td>
                </tr>
            </table>
        </tr>


    </table>
    <!--<span class="normal-span"  >u1(mm):</span>
    <input id="u1">
    <span class="normal-span"  >u2(mm):</span>
    <input id="u2">
    <span class="normal-span"  >R(mm):</span>
    <input id="r">
    <span class="normal-span"  >圆度误差(mm):</span>
    <input id="f">-->
</div>
<!--虚拟仪器库-->
<script src="js/VILibrary.js"></script>
<!--js简写方法-->
<script src="js/jquery-3.1.1.min.js"></script>
<!--弹出框-->
<script src="js/layui/lay/dest/layui.all.js"></script>

<!--三维显示库-->
<script src="js/three/three.js"></script>
<script src="js/three/MTLLoader.js"></script>
<script src="js/three/OBJLoader.js"></script>
<script src="js/three/controls/OrbitControls.js"></script>
<script src="js/three/ObjectControls.js"></script>
<script>
    'use strict';

    let roundnessVI = new VILibrary.VI.RoundnessVI($('#mainCanvas'), true);
    let NyquistVI = new VILibrary.VI.NyquistVI($('#myDial'));
    VILibrary.InnerObjects.bindDataLine(roundnessVI.id, NyquistVI.id, 1, 0);
    function calcu() {
        var  len = document.getElementById("roundnessData").rows.length;
        console.log(len);
        var R=70,r=0,u1=0,u2=0,deltaR=[0];
        for (let i=0; i<=len-2;i++){
            r+=document.getElementById("e"+i).innerHTML/len;
            u1+=-2/len*document.getElementById("e"+i).innerHTML*Math.cos(Math.PI*2/len*i);
            u2+=-2/len*document.getElementById("e"+i).innerHTML*Math.sin(Math.PI*2/len*i)
//            console.log("Element",document.getElementById("e"+i));
//            console.log("text",document.getElementById("e"+i).value);
//            console.log( "value",parseFloat(document.getElementById("e"+3).innerHTML));


        }
        document.getElementById("u1").innerHTML=u1.toFixed(2);
        document.getElementById("u2").innerHTML=u2.toFixed(2);
        document.getElementById("r").innerHTML=(r+R).toFixed(2);
        NyquistVI.draw(r+R);
        for (let i=0; i<=len-2;i++){//计算圆度误差
            var dr=document.getElementById("e"+i).innerHTML-(r+u1*Math.cos(Math.PI*2/len*i)+u2*Math.sin(Math.PI*2/len*i));
            deltaR.push(dr);
        }
        var f= Math.max.apply(Math,deltaR)-Math.min.apply(Math,deltaR);
        document.getElementById("f").innerHTML=f.toFixed(2);



    }
</script>
</body>
</html>